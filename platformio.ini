; Racing Dashboard - PlatformIO Configuration
; Target: STM32H7B3 with RVT70HSSNWN00 Display (1024x600)

[platformio]
default_envs = stm32h7b3

[env:stm32h7b3]
platform = ststm32
board = nucleo_h7b3i
framework = arduino

; STM32H7B3 specific settings
board_build.mcu = stm32h7b3lihxq
board_build.f_cpu = 280000000L

; Upload settings
upload_protocol = stlink
debug_tool = stlink

; Build flags
build_flags =
    -D STM32H7B3xx
    -D HAL_LTDC_MODULE_ENABLED
    -D HAL_DMA2D_MODULE_ENABLED
    -D HAL_SDRAM_MODULE_ENABLED
    -D USE_FULL_LL_DRIVER
    -D ARM_MATH_CM7
    ; Display configuration
    -D DISPLAY_WIDTH=1024
    -D DISPLAY_HEIGHT=600
    -D DISPLAY_BPP=24
    -D LVGL_BUFFER_SIZE=153600
    ; TouchGFX integration
    -D USE_TOUCHGFX
    -D TOUCHGFX_VERSION_MAJOR=4
    -D TOUCHGFX_VERSION_MINOR=23
    ; Features
    -D ENABLE_ADVANCED_LOGGING
    -D ENABLE_LAP_TIMER
    -D ENABLE_CAN_SECURITY
    -D ENABLE_CAMERA_MANAGER
    ; Optimization
    -O2
    -g3
    -Wall
    -Wextra
    -ffunction-sections
    -fdata-sections
    ; FPU support
    -mfpu=fpv5-d16
    -mfloat-abi=hard

build_unflags =
    -Os

; Libraries
lib_deps =
    lvgl/lvgl@^8.3.11
    bblanchon/ArduinoJson@^6.21.4
    adafruit/Adafruit GFX Library@^1.11.9
    bodmer/TFT_eSPI@^2.5.43
    ; CAN libraries
    sandeepmistry/arduino-CAN@^0.3.1
    ; GPS
    mikalhart/TinyGPSPlus@^1.0.3
    ; SD Card
    arduino-libraries/SD@^1.2.4
    ; Compression
    prampec/IotWebConf@^3.2.1
    ; WiFi (ESP32 sidecar)
    espressif/arduino-esp32@^2.0.14

; Extra scripts
extra_scripts =
    pre:scripts/generate_touchgfx.py
    post:scripts/compress_binary.py

; Monitor settings
monitor_speed = 115200
monitor_filters =
    colorize
    time
    log2file

; Testing environment
[env:native]
platform = native
build_flags =
    -D UNIT_TEST
    -std=c++17
lib_deps =
    google/googletest@^1.14.0

[env:simulator]
platform = native
build_flags =
    -D SIMULATOR_MODE
    -D DISPLAY_WIDTH=1024
    -D DISPLAY_HEIGHT=600
    -std=c++17
    -lSDL2
lib_deps =
    lvgl/lvgl@^8.3.11
    bblanchon/ArduinoJson@^6.21.4
