# Проект цифровой приборной панели для гоночного авто

## Цели проекта
Создать компактную и яркую цифровую приборную панель уровня устройств **ECUMaster ADU7**, **Motec C187** и **AIM**, с полной интеграцией по CAN-шине, расширенными возможностями записи логов и удобной конфигурацией через десктопное приложение и Wi‑Fi.

## Ключевые требования
- **Отображение и UX:** антибликовое покрытие, угол обзора ≥ 80° по вертикали/горизонтали, пиковая яркость ≥ 1000 нит с автоматической регулировкой (датчик освещённости, диммирование PWM подсветки).
- **Частота обновления:** 60 Гц для UI, обработка входных сигналов ≥ 200 Гц.
- **Интерфейсы ввода:** 10 аналоговых входов (0–5 В, защитные схемы, АЦП 12–16 бит, частота ≥ 1 кГц) и 10 цифровых входов (5/12 В tolerant, возможность pull-up/down, дебаунс).
- **CAN:** два независимых канала CAN FD (до 5 Мбит/с), поддержка стандартных и пользовательских DBC, приём/передача, фильтры по ID, передача диагностических сообщений.
- **GPS:** встроенный 25 Гц модуль (GNSS: GPS/GLONASS/Galileo) с PPS для синхронизации логов.
- **Логирование:** встроенный логер на microSD/EEPROM, частота записи до 200 Гц, сохранение в форматах CSV/JSON и бинарных для быстрой выборки, защита от потери питания (журналирование транзакций).
- **Связь и конфигурация:**
  - USB-C (Device) для прошивки и live-конфигурации.
  - Wi‑Fi AP/STA режимы, настройка через web-интерфейс и десктопное приложение по TCP/REST.
  - OTA-обновления прошивки с двойным слотом.
- **Прочее:** защита от вибраций (авто-соединения), питание 9–18 В, защита по обратной полярности, влагозащита IP54+.

## Программные модули
- **Firmware (MCU):**
  - HAL для CAN, GPIO, ADC, PWM подсветки.
  - Драйвер дисплея и рендеринг UI (графические элементы, телеметрия, предупредительные сообщения).
  - Логер с буферизацией и синхронизацией по PPS.
  - Менеджер конфигурации (профили, checksum, версия схемы сигналов).
  - OTA-апдейтер и безопасный бутлоадер.
- **Desktop Config Tool:**
  - Windows/macOS/Linux, написан на Qt или Electron.
  - Подключение по USB/Wi‑Fi, импорт/экспорт DBC, редактор отображений (dash layout builder), настройка триггеров предупреждений, обновление прошивки.
  - Просмотр логов и быстрая телеметрия в реальном времени (графики, карта трассы по GPS).
- **Embedded Web UI:** упрощённая конфигурация через браузер в Wi‑Fi (статический SPA + REST/WebSocket).

## Логическая архитектура
- **Сбор данных:** драйверы CAN, ADC и цифровых входов публикуют данные в шину событий (pub/sub в MCU).
- **Нормализация:** парсинг DBC, скейлинг аналоговых каналов, дебаунс цифровых входов, вычисление производных (скорость, ускорение, давление, температура).
- **Представление:** слой шаблонов для экранов (виджеты: тахометр, шифты, статусные индикаторы, таймеры круга, карта трассы), поддержка нескольких страниц и пользовательских цветов.
- **Логирование:** очередь событий с приоритезацией, фоновая запись на SD, автоматический split файлов по размеру/времени, отметка GPS-времени.
- **Диагностика:** самотест при старте, журнал ошибок, экспорт health-отчёта через конфигуратор.

## Производственные характеристики
- **Дисплей:** 7" IPS 1280×480, антиблик, стекло Gorilla/сапфир, PWM подсветка 1–20 кГц.
- **Процессор:** ARM Cortex-M7/M33 (например, STM32H7B3) или SoC на базе i.MX RT, 2×CAN FD, достаточный графический контроллер.
- **Память:** 2–4 МБ Flash + 1 МБ SRAM, внешняя SDRAM 16–64 МБ, microSD слот.
- **Датчики:** датчик освещённости (ALS), датчик температуры корпуса для автотроттлинга подсветки.
- **Корпус:** алюминий с радиатором, влагозащита, разъём autosport или Deutsch DT.

## ПО и конфигурация
- **Безопасность данных:** контроль целостности конфигураций (CRC), резервное копирование профилей на SD/десктоп.
- **Шаблоны и пресеты:** готовые профили для популярных ЭБУ (ECUMaster/Motec/AIM) и серий соревнований.
- **API конфигуратора:** DBC + пользовательские расчётные каналы (формулы), настройка порогов предупреждений (масло, температура, давление, топливо), логика переключения экранов (по скорости/шестерне/входам).
- **Wi‑Fi настройка:** captive portal при первом включении, поддержка WPA2/WPA3.

## Список основных компонентов (BOM, черновик)
- Дисплей 7" IPS 1280×480, антибликовое стекло.
- MCU/SoC с 2×CAN FD (STM32H7B3 или NXP i.MX RT1062) + внешняя SDRAM.
- CAN-трансиверы (TCAN1042/FD, ADM3055E).
- GNSS‑модуль 25 Гц (u-blox NEO-M9N) с PPS.
- АЦП/входной фронт: 10× аналоговых каналов с защитой (TVS диоды, RC фильтр).
- 10× цифровых входов с защёлками/дебаунсом, поддержка 5/12 В.
- ALS датчик яркости (например, VEML7700) + температура корпуса.
- Подсветка: LED драйвер с PWM (1–20 кГц) и диммированием.
- Питание: DC-DC 9–18 В → 5 В/3.3 В, защита по обратной полярности, TVS.
- Хранилище: microSD slot (industrial grade) + NOR Flash для OTA двойного слота.
- Интерфейсы: USB-C (Device), Wi‑Fi модуль (ESP32/ESP32-S3) в режиме сопроцессора.
- Разъём: Deutsch DT/AUTOSPORT, гермовводы, уплотнения.
- Механика: алюминиевый корпус/радиатор, виброзащита, теплоотвод.

## Следующие шаги
1. Уточнить целевые ЭБУ/протоколы и подготовить DBC-библиотеку.
2. Спроектировать схемотехнику ввода/вывода и выбрать точные компоненты по доступности.
3. Определить стек UI/графики (например, LVGL) и формат шаблонов приборки.
4. Создать прототип конфигуратора (Qt/Electron) с минимальным набором функций: DBC импорт, редактор экранов, OTA.
5. Провести тепловой и виброанализ корпуса, подобрать подсветку и стекло.
